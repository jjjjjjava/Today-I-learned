[toc]

## å‰è¨€

> å­¦ä¹ è¦ç¬¦åˆå¦‚ä¸‹çš„æ ‡å‡†åŒ–é“¾æ¡ï¼šäº†è§£æ¦‚å¿µ->æ¢ç©¶åŸç†->æ·±å…¥æ€è€ƒ->æ€»ç»“æç‚¼->åº•å±‚å®ç°->å»¶ä¼¸åº”ç”¨"

## 01.å­¦ä¹ æ¦‚è¿°

- **å­¦ä¹ ä¸»é¢˜**ï¼šovoparkä¸­é—¨åº—è§†é¢‘æ’­æ”¾é€»è¾‘
- **çŸ¥è¯†ç±»å‹**ï¼š
  - [ ] **çŸ¥è¯†ç±»å‹**ï¼š
    - [ ] âœ…Android/ 
      - [ ] âœ…01.åŸºç¡€ç»„ä»¶
      - [ ] âœ…02.IPCæœºåˆ¶
      - [ ] âœ…03.æ¶ˆæ¯æœºåˆ¶
      - [ ] âœ…04.ViewåŸç†
      - [ ] âœ…05.äº‹ä»¶åˆ†å‘æœºåˆ¶
      - [ ] âœ…06.Window
      - [ ] âœ…07.å¤æ‚æ§ä»¶
      - [ ] âœ…08.æ€§èƒ½ä¼˜åŒ–
      - [ ] âœ…09.æµè¡Œæ¡†æ¶
      - [ ] âœ…10.æ•°æ®å¤„ç†
      - [ ] âœ…11.åŠ¨ç”»
      - [ ] âœ…12.Groovy
    - [ ] âœ…éŸ³è§†é¢‘å¼€å‘/
      - [ ] âœ…01.åŸºç¡€çŸ¥è¯†
      - [ ] âœ…02.OpenGLæ¸²æŸ“è§†é¢‘
      - [ ] âœ…03.FFmpegéŸ³è§†é¢‘è§£ç 
    - [ ] âœ… Java/
      - [ ] âœ…01.åŸºç¡€çŸ¥è¯†
      - [ ] âœ…02.Javaè®¾è®¡æ€æƒ³
      - [ ] âœ…03.é›†åˆæ¡†æ¶
      - [ ] âœ…04.å¼‚å¸¸å¤„ç†
      - [ ] âœ…05.å¤šçº¿ç¨‹ä¸å¹¶å‘ç¼–ç¨‹
      - [ ] âœ…06.JVM
    - [ ] âœ… Kotlin/
      - [ ] âœ…01.åŸºç¡€è¯­æ³•
      - [ ] âœ…02.é«˜é˜¶æ‰©å±•
      - [ ] âœ…03.åç¨‹å’Œæµ
- **å­¦ä¹ æ¥æº**ï¼š
- **é‡è¦ç¨‹åº¦**ï¼šâ­â­â­â­â­ï¼ˆæ ¸å¿ƒåŸºç¡€ï¼‰  
- **å­¦ä¹ æ—¥æœŸ**ï¼š
- **è®°å½•äºº**ï¼š@panruiqi

### 1.1 å­¦ä¹ ç›®æ ‡

- äº†è§£æ¦‚å¿µ->æ¢ç©¶åŸç†->æ·±å…¥æ€è€ƒ->æ€»ç»“æç‚¼->åº•å±‚å®ç°->å»¶ä¼¸åº”ç”¨"

### 1.2 å‰ç½®çŸ¥è¯†



## 02.æ ¸å¿ƒæ¦‚å¿µ

### 2.1 æ˜¯ä»€ä¹ˆï¼Ÿ

é—¨åº—ä¸­é—¨åº—è§†é¢‘çš„æ’­æ”¾é€»è¾‘


### 2.2 è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

ä¸šåŠ¡æµç¨‹ç†è§£è–„å¼±

### 2.3 åŸºæœ¬ç‰¹æ€§



## 03.åŸç†æœºåˆ¶

### 3.1 è§†é¢‘ä»»åŠ¡ä¸‹å‘ç»™Handler

ä»handleVideoSwitchå¼€å§‹

- ![image-20250704164433931](../../_pic_/image-20250704164433931.png)
- ![image-20250704164549031](../../_pic_/image-20250704164549031.png)
- ![image-20250704171407015](../../_pic_/image-20250704171407015.png)
- ![image-20250704171513871](../../_pic_/image-20250704171513871.png)

è§†é¢‘æ’­æ”¾å‡ºç°åˆ†æ”¯äº†ï¼Œä»–çš„åˆ†æ”¯æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ

- å¦‚æœæ˜¯ OSS ç¬¬ä¸‰æ–¹è®¾å¤‡ï¼Œç›´æ¥ç”¨ startPlay æ’­æ”¾æŒ‡å®š URLï¼Œä¸èµ°åç»­åˆ†æ”¯ã€‚
- å¦‚æœå½“å‰æ˜¯â€œå†å²å›æ”¾â€æ¨¡å¼ï¼Œå¹¶ä¸”æœ‰åˆæ³•çš„å›æ”¾æ—¶é—´åŒºé—´ï¼š
  - å¦‚æœ startFlvRightNow ä¸º trueï¼Œç›´æ¥è°ƒç”¨ playVideoPlayback æ’­æ”¾å›æ”¾è§†é¢‘ã€‚
  - å¦åˆ™ï¼Œæ¸…ç†ç›¸å…³æ¶ˆæ¯ã€‚
  - æœ€åæ— è®ºå“ªç§æƒ…å†µï¼Œéƒ½ä¼šå‘é€ MSG_PLAY_VIDEO æ¶ˆæ¯ï¼Œè§¦å‘åç»­æ’­æ”¾æµç¨‹ï¼Œå¹¶ return
- å¦‚æœä¸æ˜¯ OSS è®¾å¤‡ï¼Œä¹Ÿä¸æ˜¯å†å²å›æ”¾æ¨¡å¼ï¼Œé»˜è®¤å°±æ˜¯ç›´æ’­æ¨¡å¼ï¼Œç›´æ¥å‘é€ MSG_PLAY_VIDEOï¼Œè®© Handler ç»Ÿä¸€è°ƒåº¦æ’­æ”¾æµç¨‹

### 3.2 Handlerå¤„ç†è§†é¢‘ä»»åŠ¡

å¥½ï¼Œè§†é¢‘æœ€ç»ˆé€šè¿‡mHandlerå‘é€ä¸€ä¸ªMSG_PLAY_VIDEOæ¶ˆæ¯å§”æ‰˜å‡ºå»è¿›è¡Œæ’­æ”¾ä»»åŠ¡ï¼Œé‚£ä»–çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

- ![image-20250704171906052](../../_pic_/image-20250704171906052.png)
- ![image-20250704172059690](../../_pic_/image-20250704172059690.png)
- ![image-20250704172117927](../../_pic_/image-20250704172117927.png)
- ![image-20250704172129305](../../_pic_/image-20250704172129305.png)
- ![image-20250704172246003](../../_pic_/image-20250704172246003.png)
- ![image-20250704172253635](../../_pic_/image-20250704172253635.png)

è¿›å…¥åˆ°è¿™ä¸€å—

- ![image-20250704172408440](../../_pic_/image-20250704172408440.png)
- ![image-20250704172451851](../../_pic_/image-20250704172451851.png)
- è‡ªæœ‰å¹³å°ç›´æ’­ï¼Œå…ˆæŸ¥è¯¢ AccessTokenï¼Œå†å‘èµ·æ’­æ”¾ã€‚
- å…¶ä»–æƒ…å†µï¼ˆå¦‚å›æ”¾ï¼‰ï¼Œç›´æ¥è°ƒç”¨ startPlay2() æ’­æ”¾ã€‚

æœ€ç»ˆçš„çœŸå®æ’­æ”¾ä½ç½®

- ![image-20250704172549918](../../_pic_/image-20250704172549918.png)
- ![image-20250704172738935](../../_pic_/image-20250704172738935.png)
- ![image-20250704172859018](../../_pic_/image-20250704172859018.png)



### 3.3 è¿™ä¸ªHandlerè®¾è®¡çš„å·§å¦™ä¹‹å¤„

è¿™é‡Œçš„mHandleræ˜¯ä»€ä¹ˆï¼Ÿ

- åº”å½“æ˜¯ç»§æ‰¿è‡ªBaseToolbarFragment

- ![image-20250704164631200](../../_pic_/image-20250704164631200.png)
- ![image-20250704164737689](../../_pic_/image-20250704164737689.png)
- ![image-20250704164715651](../../_pic_/image-20250704164715651.png)
- ![image-20250704164852540](../../_pic_/image-20250704164852540.png)

è¿™ä¸ªHandlerè®¾è®¡çš„å·§å¦™ä¹‹å¤„

- ä»£ç å—å¦‚ä¸‹ï¼š
  - ![image-20250704164852540](../../_pic_/image-20250704164852540.png)

- æ™®é€šHandlerå­˜åœ¨å†…å­˜æ³„æ¼çš„é—®é¢˜

  - ```
    // âŒ ä¼ ç»Ÿå†™æ³• - ä¼šé€ æˆå†…å­˜æ³„æ¼
    private Handler mHandler = new Handler() {
        @Override
        public void handleMessage(Message msg) {
            // è¿™é‡Œéšå¼æŒæœ‰å¤–éƒ¨ç±»çš„å¼ºå¼•ç”¨
            // å¦‚æœæœ‰å»¶è¿Ÿæ¶ˆæ¯ï¼Œä¼šé˜»æ­¢ Activity/Fragment è¢« GC å›æ”¶
        }
    };
    ```

  - é—®é¢˜ï¼šHandler ä½œä¸ºå†…éƒ¨ç±»ï¼Œéšå¼æŒæœ‰å¤–éƒ¨ç±»çš„å¼ºå¼•ç”¨ï¼Œå¯¼è‡´ï¼š

  - Activity/Fragment æ— æ³•è¢«åƒåœ¾å›æ”¶

  - é€ æˆå†…å­˜æ³„æ¼

  - ç‰¹åˆ«æ˜¯æœ‰å»¶è¿Ÿæ¶ˆæ¯æ—¶æ›´ä¸¥é‡

- å†…å­˜æ³„æ¼ï¼Ÿæ¯”å¦‚ï¼š

  - Fragment/Activity æ˜æ˜å·²ç»é€€å‡ºï¼Œä½†å› ä¸º Handler è¿˜æŒæœ‰å®ƒçš„å¼ºå¼•ç”¨ï¼Œå¯¼è‡´å®ƒä¸€ç›´ç•™åœ¨å†…å­˜ä¸­ï¼Œè¿™å°±æ˜¯å†…å­˜æ³„æ¼ã€‚

- å½“å‰Handlerçš„ä¼˜å¼‚ä¹‹å¤„ï¼Ÿ

  - ```
    public static class UnLeakHandler extends Handler {
        // ğŸ¯ å…³é”®1: static é™æ€ç±»ï¼Œä¸æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨
        
        WeakReference<BaseToolbarFragment> mWeakReferenceFragment;
        // ğŸ¯ å…³é”®2: WeakReference å¼±å¼•ç”¨ï¼Œä¸é˜»æ­¢ GC
    
        public UnLeakHandler(BaseToolbarFragment fragment) {
            mWeakReferenceFragment = new WeakReference<>(fragment);
            // ğŸ¯ å…³é”®3: æ˜¾å¼ä¼ å…¥ Fragment å¼•ç”¨å¹¶åŒ…è£…ä¸ºå¼±å¼•ç”¨
        }
    
        @Override
        public void handleMessage(Message msg) {
            super.handleMessage(msg);
            if (null != mWeakReferenceFragment.get()) {
                // ğŸ¯ å…³é”®4: æ£€æŸ¥å¼•ç”¨æ˜¯å¦è¿˜å­˜åœ¨
                BaseToolbarFragment fragment = mWeakReferenceFragment.get();
                fragment.handleMessage(msg);
                // ğŸ¯ å…³é”®5: å§”æ‰˜ç»™ Fragment å¤„ç†
            }
            // ğŸ¯ å…³é”®6: å¦‚æœ Fragment å·²è¢«å›æ”¶ï¼Œæ¶ˆæ¯è‡ªåŠ¨ä¸¢å¼ƒ
        }
    }
    ```

  - ä¸ºä»€ä¹ˆæ˜¯é™æ€ç±»ï¼Ÿ

    - æ™®é€šç±»å†…éƒ¨å­˜åœ¨éšå¼å¼•ç”¨çš„é—®é¢˜

    - ```
        public class MyFragment extends Fragment {
            private Handler mHandler = new Handler() {
                @Override
                public void handleMessage(Message msg) { ... }
            };
        }
      ```

    - è¿™ç§å†™æ³•ï¼ŒHandler æ˜¯ MyFragment çš„éé™æ€å†…éƒ¨ç±»ï¼Œä¼šè‡ªåŠ¨æŒæœ‰å¤–éƒ¨ç±»ï¼ˆMyFragmentï¼‰çš„å¼ºå¼•ç”¨ã€‚

    - åªè¦ Handler æ´»ç€ï¼ŒMyFragment å°±ä¸ä¼šè¢« GC å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚

  - é€šè¿‡å¼±å¼•ç”¨ï¼Œæ„é€ æ—¶ä¼ å…¥ fragmentï¼Œå¹¶ç”¨ WeakReference åŒ…è£¹ã€‚è¿™æ ·ï¼ŒHandler åªæŒæœ‰ Fragment çš„å¼±å¼•ç”¨ï¼Œä¸ä¼šé˜»æ­¢ Fragment è¢« GC

- å¥½ï¼Œæ¶ˆæ¯çš„å¤„ç†æµç¨‹å‘¢ï¼Ÿ

  - å½“æœ‰æ¶ˆæ¯åˆ°è¾¾ Handler æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ UnLeakHandler.handleMessage(msg)

  - ```
      @Override
      public void handleMessage(Message msg) {
          if (null != mWeakReferenceFragment.get()) {
              BaseToolbarFragment fragment = mWeakReferenceFragment.get();
              fragment.handleMessage(msg); // è®© fragment å¤„ç†æ¶ˆæ¯
          }
      }
    ```

  - ä¹Ÿå°±æ˜¯è¯´ï¼ŒHandler æ”¶åˆ°æ¶ˆæ¯åï¼Œè½¬æ‰‹åˆäº¤ç»™ Fragment çš„ handleMessage æ–¹æ³•å¤„ç†

- ä»–çš„è®¾è®¡æ€æƒ³æœ¬è´¨å°±æ˜¯ä¸€ä¸ªè½¬äº¤çš„è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯é˜²æ­¢æŒæœ‰Fragmentçš„å¼ºå¼•ç”¨ï¼Œç”¨äºé˜²æ­¢å†…å­˜æ³„æ¼ï¼Œå°¤å…¶é€‚åˆ Fragment/Activity è¿™ç§ç”Ÿå‘½å‘¨æœŸçŸ­ã€å®¹æ˜“è¢«å›æ”¶çš„ç»„ä»¶ã€‚

### 3.4 è¿™ä¸ªHandlerå¤„ç†çš„è¿‡ç¨‹

æˆ‘ä»¬newäº†ä¸€ä¸ªUnLeakHandler ï¼Œå¯æ˜¯ä¸ºä»€ä¹ˆä»»åŠ¡ä¼šå‘ç»™ä»–ï¼Ÿè€Œä¸æ˜¯å‘ç»™å…¶ä»–çš„Handlerï¼Ÿ

- ä¸»çº¿ç¨‹åªæœ‰ä¸€ä¸ª Looperï¼Œä½†å¯ä»¥æœ‰å¾ˆå¤š Handler

- Handler æ˜¯ä½  new å‡ºæ¥çš„ï¼Œä½ å¯ä»¥ new æ™®é€š Handlerï¼Œä¹Ÿå¯ä»¥ new UnLeakHandlerã€‚

- æ¶ˆæ¯å‘ç»™è°ï¼Œå®Œå…¨å–å†³äºä½ ä»£ç é‡Œç”¨çš„æ˜¯å“ªä¸ª Handlerå‘é€ä»»åŠ¡ã€‚

- ```
  Handler handlerA = new Handler();
  Handler handlerB = new Handler();
  
  handlerA.sendEmptyMessage(1); // è¿™æ¡æ¶ˆæ¯åªä¼šè¢« handlerA å¤„ç†
  handlerB.sendEmptyMessage(2); // è¿™æ¡æ¶ˆæ¯åªä¼šè¢« handlerB å¤„ç†
  ```

- è°å‘æ¶ˆæ¯ï¼Œè°æ”¶æ¶ˆæ¯ã€‚ä½ ç”¨å“ªä¸ª Handler å‘ï¼Œæ¶ˆæ¯å°±è¿›å“ªä¸ª Handler çš„é˜Ÿåˆ—ã€‚

é‚£ä¹ˆï¼Œå‡å¦‚ä½ é€šè¿‡ä»–å‘é€æ¶ˆæ¯

- ```
  mHandler.sendEmptyMessage(MSG_PLAY_VIDEO);
  ```

- é¦–å…ˆï¼Œä»–ä¼šè¢«æ”¾åˆ°ä¸»çº¿ç¨‹çš„looperä¸­ï¼Œç„¶åç»è¿‡looper.loopï¼Œæ‰¾åˆ°mHandlerï¼Œç”±ä½ è‡ªå·±å¤„ç†

- ```
   public void handleMessage(Message msg) {
          super.handleMessage(msg);
          if (null != mWeakReferenceFragment.get()) {
              // ğŸ¯ å…³é”®4: æ£€æŸ¥å¼•ç”¨æ˜¯å¦è¿˜å­˜åœ¨
              BaseToolbarFragment fragment = mWeakReferenceFragment.get();
              fragment.handleMessage(msg);
              // ğŸ¯ å…³é”®5: å§”æ‰˜ç»™ Fragment å¤„ç†
          }
          // ğŸ¯ å…³é”®6: å¦‚æœ Fragment å·²è¢«å›æ”¶ï¼Œæ¶ˆæ¯è‡ªåŠ¨ä¸¢å¼ƒ
      }
  ```

- é€šè¿‡æ£€æŸ¥ï¼Œäº¤ç»™Fragmentçš„handleMessageæ–¹æ³•å¤„ç†

### 3.5 è¿™ä¸ªHandleræœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿæœ‰æ²¡æœ‰æ›´ä¼˜è¶Šçš„æ–¹æ¡ˆ

UnLeakHandler çš„ä¼˜ç¼ºç‚¹

- ä¼˜ç‚¹
  - å½»åº•è§£å†³ Handler å¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼ˆåªè¦é¡µé¢è¢«å›æ”¶ï¼Œæ¶ˆæ¯è‡ªåŠ¨ä¸¢å¼ƒï¼‰
  - å…¼å®¹æ€§å¥½ï¼Œé€‚ç”¨äºæ‰€æœ‰ Android ç‰ˆæœ¬
  - å®ç°ç®€å•ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- ç¼ºç‚¹
  - æ¶ˆæ¯ä¸¢å¤±ï¼šå¦‚æœ Fragment/Activity è¢«å›æ”¶ï¼ŒHandler æ”¶åˆ°æ¶ˆæ¯æ—¶ä¼šç›´æ¥ä¸¢å¼ƒï¼Œä¸ä¼šæœ‰ä»»ä½•æç¤ºï¼Œæœ‰äº›ä¸šåŠ¡åœºæ™¯ä¸‹å¯èƒ½å¯¼è‡´â€œæ¶ˆæ¯ä¸¢å¤±â€ã€‚
- ä»£ç å†—ä½™ï¼šæ¯ä¸ªé¡µé¢éƒ½è¦å†™ä¸€éç±»ä¼¼çš„ Handler ä»£ç ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚
- ä¸šåŠ¡é€»è¾‘åˆ†æ•£ï¼šæ¶ˆæ¯å¤„ç†é€»è¾‘åˆ†æ•£åœ¨ Fragment/Activity å’Œ Handler ä¹‹é—´ï¼Œä¸å¤Ÿç›´è§‚ã€‚
- ä»éœ€æ‰‹åŠ¨ç®¡ç†ï¼šä½ éœ€è¦è‡ªå·±åˆ¤æ–­é¡µé¢æ˜¯å¦è¿˜æ´»ç€ï¼Œè‡ªå·±å†³å®šæ˜¯å¦å¤„ç†æ¶ˆæ¯ã€‚

æ›´å¥½çš„æ–¹æ¡ˆï¼š

- ä½¿ç”¨ ViewModel + LiveDataï¼ˆæ¨èï¼‰
- ä½¿ç”¨åç¨‹ï¼ˆKotlin Coroutineï¼‰+ ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥

## 04.åº•å±‚åŸç†



## 05.æ·±åº¦æ€è€ƒ

### 5.1 å…³é”®é—®é¢˜æ¢ç©¶



### 5.2 è®¾è®¡å¯¹æ¯”



## 06.å®è·µéªŒè¯

### 6.1 è¡Œä¸ºéªŒè¯ä»£ç 



### 6.2 æ€§èƒ½æµ‹è¯•





## 07.åº”ç”¨åœºæ™¯

### 7.1 æœ€ä½³å®è·µ



### 7.2 ä½¿ç”¨ç¦å¿Œ





## 08.æ€»ç»“æç‚¼

### 8.1 æ ¸å¿ƒæ”¶è·



### 8.2 çŸ¥è¯†å›¾è°±



### 8.3 å»¶ä¼¸æ€è€ƒ





## 09.å‚è€ƒèµ„æ–™

1. []()
2. []()
3. []()

