## 📅 Android 开发工作周报

**汇报人：** [潘锐琦]  

---

## 🗓 日报记录

1. **今日工作要点：**  
   - 【概述】一句话说今天主要做了什么  
2. **难点 & 解决：**  
   - 【难点】简述遇到的最大挑战  
   - 【方案】如何定位、思路与结果  
3. **收获 & 思考：**  
   - 【收获】新知识、工具或有趣发现  
   - 【思考】对后续工作的启发

---

## 🗓 日报记录（周一）

1. **今日工作要点：**  
   - 【概述】
2. **难点 & 解决：**  
   - 【难点】
     - 
   - 【方案】如何定位、思路与结果  
     - 
3. **收获 & 思考：**  
   - 【收获】
   - 【思考】

## 🗓 日报记录（周二）

1. **今日工作要点：**  
   - 【概述】
     - 我们来设计架构，你现在要考虑这几个点：
       -  Main页中调用 /on-duty-service/store/goods/getTraceabilityCodeEnabled 获取【购买药品】是否需要溯源码开关，设置给自己内部的成员变量。      
       - 扫码商品阶段，根据type切到不同的弹窗流程分支。如果是药品（type=1或2），且开关开启，则弹出扫描追溯码弹窗，并且应该有超时30s标记。 
       - 需要有数据结构记录本次app存活周期内的追溯码，可变长列表存储就行了，
       - 追溯码扫描后返回来进行的商品价格计算流程，要跟已有的流程兼容，也就是到这开始分支合并了。
       -  用户点击按钮加购1件，该如何处理？         
       - 追溯码和药品码的规则：     
       - 如何修改api适配上面的。
       - 是不是忽略了一个问题：DSL架构中：会验证对应的条码类型，调用对应的Handler。你还需要补充：药品码和追溯码的校验规则，同时添加对应的处理器。
       - 我们增加药品的时候，会增加追溯码，那么我们减少商品的时候，应该是要减少追溯码的。我们怎么知道应该减少的是哪一个追溯码？      难道我们要让追溯码和商品一一对应，同时记录加购的过程？通过栈记录每个药品的加购过程？
       - 我初步打算设计一个栈，和新的数据结构，让药品码和追溯码一一对应。然后减少 就出栈，将对应的数据结构包括药品码和追溯码出栈。这样可以实现这个功能。
       - 但是存在新的问题：用户扫了当前的药品码，但是不扫当前的追溯码，扫另一个药品的追溯码，此时又不好处理了。他们的容错机制该怎么做？我觉得有点棘手。
       - 现在没有校验的，只要是20位数字就行，就是暂时没法从追溯码知道是哪盒药，我们只能纯记录，好，如果这样，那药品码和追溯码就不应该一一对应，就是栈保存追溯码，后进先出pop出去。
       
     - 根据架构师的设计，阶段三需要实现：
     
       1. 扩展MainViewModel支持药品追溯码状态管理
     
       1. 实现药品扫码流程状态机
     
       1. 集成追溯码栈管理到购物车系统
     
       1. 集成追溯码开关API和商品类型判断
2. **难点 & 解决：**  
   - 【难点】
     - 
   - 【方案】如何定位、思路与结果  
     - 
3. **收获 & 思考：**  
   - 【收获】
   - 【思考】

## 🗓 日报记录（周三）

1. **今日工作要点：**  
   - 【概述】
2. **难点 & 解决：**  
   - 【难点】
     - 
   - 【方案】如何定位、思路与结果  
     - 
3. **收获 & 思考：**  
   - 【收获】
   - 【思考】

## 🗓 日报记录（周四）

1. **今日工作要点：**  
   - 【概述】
     - 处理Pos_解决药品弹窗保留在栈中的问题
     - 处理Pos_不使用追溯码错误的弹窗
     - 处理Pos_生成订单中带上追溯码
     - 处理Pos_添加语音相关功能
     - 代码收尾，处理String问题和其他样式，验证未对其他模块造成意外影响
     - 拉取代码仓库，解决冲突，解决拉取后编译失败的问题，合并代码
     - 学习ARouter
     - 处理Pos_状态管理错误，当处于等待追溯码的状态时，能接收到其他的扫描处理
     - fix(traceability): 进行追溯码的正确的状态管理 panruiqi 48 minutes ago
     - feat(Popup): 追溯码扫描成功的弹窗 panruiqi 35 minutes ago
2. **难点 & 解决：**  
   - 【难点】
     - 处理Pos_状态管理错误，当处于等待追溯码的状态时，能接收到其他的扫描处理
       - 设计拦截器模式
       - 
   - 【方案】如何定位、思路与结果  
     - 
3. **收获 & 思考：**  
   - 【收获】
   - 【思考】
     - 我在flutter上出现了设计问题，或者说是架构设计的问题，在设计Flutter与原生平台交互的时候，应该注意以下原则：原生层只提供Flutter无法直接获取的系统能力
     - 当时我的想法是：UDP 发送需要原生底层能力，所以就放在了 Android 侧。但其实更合理的做法是：UDP 协议逻辑 Dart 层就能处理，原生层只需要提供系统层面 Flutter 拿不到的能力（比如本机 MAC、WiFi 信息等）。

## 🗓 日报记录（周五）

1. **今日工作要点：**  
   - 【概述】
     - feat(Popup): 富文本支持 panruiqi Today 10:00
     - style(Popup): 商品和药品加购弹窗优化 panruiqi Today 10:19
     - feat(traceability): 清除假数据，让其能根据追溯码开关正确的设置状态 panruiqi Today 11:06
     - fix(traceability): http请求传参错误，正确使用拦截器注入相关的depId panruiqi A minute ago
     - 陪同测试下去验证Pos升级结果
     - 和厂家沟通解决系统弹窗的问题
     - 整理自己的学习的思路，思考。反思自己这段时间的成长
     - Ipc_Search适配IOS侧修改
     - 快速解决ARouter
     - style(Ipc_Search): IOS侧修改返回给flutter的reponse，因此需要在Android的这个位置同步修改 panruiqi 30 minutes ago
     - 排查解决bug：IOS没有正确进入wifi设置成功页，进而无法跳转到H5。问题应该是 iOS 和 Android 两侧对 Flutter 页的生命周期管理不一致导致的。
2. **难点 & 解决：**  
   - 【难点】
     - 
   - 【方案】如何定位、思路与结果  
     - 
3. **收获 & 思考：**  
   - 【收获】
   - 【思考】

## 🗓 日报记录（周六）

1. **今日工作要点：**  
   - 【概述】
2. **难点 & 解决：**  
   - 【难点】
     - 
   - 【方案】如何定位、思路与结果  
     - 
3. **收获 & 思考：**  
   - 【收获】
   - 【思考】

## 🗓 日报记录（周日）

1. **今日工作要点：**  
   - 【概述】
2. **难点 & 解决：**  
   - 【难点】
     - 
   - 【方案】如何定位、思路与结果  
     - 
3. **收获 & 思考：**  
   - 【收获】
   - 【思考】

---

## 🔍 每周总结（每周固定时间填写）

1. **本周完成：**  
   - 列出 3–5 条本周关键产出或里程碑  
2. **核心经验：**  
   - 提炼最重要的技术/协作/流程收获  
3. **待改进 & 下周计划：**  
   - 本周有哪些不足  
   - 下周重点目标 & 需要的支持

---

现在 POS 扫码这块有个问题：

- 在 等待追溯码 的状态下，系统还能接收到其他扫码。
- 们之前的处理方式是“不断在各个地方加判断”，虽然能挡住，但导致逻辑分散、维护成本高。

我打算换一种方式：设计成一个 拦截器模式。

- 当进入 WaitingForTraceabilityCode 状态时，就挂一个“追溯码拦截器”。
- 这个拦截器只允许 追溯码类型 的扫码通过，其它扫码会被拦截并直接返回错误。

这样做的好处是：

- 扫码逻辑更清晰，不需要到处写 if 判断；
- 后续扩展和维护也更容易。