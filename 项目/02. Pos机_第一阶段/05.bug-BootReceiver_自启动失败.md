[toc]

## 01.é—®é¢˜è®°å½•

- **[ä¸¥é‡çº§åˆ«] **
  - [ ] âš ï¸ é˜»æ–­ (Blocker)ï¼šç³»ç»Ÿå´©æºƒã€æ ¸å¿ƒåŠŸèƒ½å®Œå…¨ä¸å¯ç”¨
  - [ ] ğŸ”´ ä¸¥é‡ (Critical)ï¼šæ ¸å¿ƒåŠŸèƒ½å—æŸï¼Œæ— å¯ç”¨æ›¿ä»£æ–¹æ¡ˆ
  - [ ] ğŸŸ  é«˜ (High)ï¼šä¸»è¦åŠŸèƒ½å—å½±å“ï¼Œä½†æœ‰ä¸´æ—¶è§£å†³æ–¹æ¡ˆ
  - [x] ğŸŸ¡ ä¸­ (Medium)ï¼šæ¬¡è¦åŠŸèƒ½é—®é¢˜ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ
  - [ ] ğŸŸ¢ ä½ (Low)ï¼šç•Œé¢é—®é¢˜æˆ–è½»å¾®å¼‚å¸¸ï¼Œä¸å½±å“åŠŸèƒ½
- **é—®é¢˜ç®€è¦æè¿°**
  - **Bug ID**ï¼š`BUG-20250604-001`  
  - **å‘ç°æ—¥æœŸ**ï¼š2025-06-04  
  - **å½±å“ç‰ˆæœ¬**ï¼šv0.4.0
  - **æäº¤äºº**ï¼š@panruiqi
  - **çŠ¶æ€**ï¼šâŒ› ä¿®å¤ä¸­

- **é—®é¢˜ç°è±¡**
  - [ ] ç³»ç»Ÿæ—¥å¿—ï¼šæœªæŠ¥é”™ï¼Œæ—¥å¿—åº”å½“å­˜åœ¨é—®é¢˜ï¼Œæ²¡æœ‰æ­£ç¡®æ£€æµ‹åˆ°è¿™ç§æƒ…å†µï¼Œå¾…ä¼˜åŒ–ã€‚
  - [ ] æ£€æµ‹ç½‘ç»œåæ— æ³•è‡ªå¯åŠ¨
  - [ ] ç›®å‰åœ¨Android 13è®¾å¤‡å‡ºç°
- **ç¯å¢ƒç‰¹å¾**
  - è®¾å¤‡å‹å·: rk3562_t
  - OSç‰ˆæœ¬: Android 13 (API 34)
  - ç½‘ç»œç¯å¢ƒ: å…¬å¸å†…ç½‘
  - ç”¨æˆ·è´¦æˆ·: primary_user (ID:0)
  - è§¦å‘æ—¶æœº: ç³»ç»Ÿå¯åŠ¨æ—¶

## 02.é—®é¢˜åˆ†æ

### 2.1 æ—¥å¿—åˆ†æ

- ```
  2025-06-04 10:54:58.654  1446-1446  (LogManager.kt:149) i   com.ovopark.cloudpos                 I  (MyApplication.kt:40) onCreate() Application onCreate completed
  2025-06-04 10:54:58.664  1446-1446  (LogManager.kt:149) i   com.ovopark.cloudpos                 I  (MyApplication.kt:56) logNetworkStatus() å½“å‰ç½‘ç»œçŠ¶æ€: å·²è¿æ¥
  2025-06-04 10:54:58.670  1446-1446  (LogManager.kt:149) i   com.ovopark.cloudpos                 I  (MyApplication.kt:60) logNetworkStatus() ç½‘ç»œç±»å‹: ä»¥å¤ªç½‘
  2025-06-04 10:54:58.678  1446-1446  (LogManager.kt:149) i   com.ovopark.cloudpos                 I  (BootReceiver.kt:21) onReceive() ç³»ç»Ÿå¯åŠ¨å®Œæˆï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥
  2025-06-04 10:54:58.684  1446-1446  (LogManager.kt:149) i   com.ovopark.cloudpos                 I  (BootReceiver.kt:24) onReceive() ç½‘ç»œå·²è¿æ¥ï¼Œå¯åŠ¨åº”ç”¨
  2025-06-04 10:54:58.690  1446-1446  (LogManager.kt:149) i   com.ovopark.cloudpos                 I  (BootReceiver.kt:66) launchApp() è·å–åˆ°å¯åŠ¨ Intent: ComponentInfo{com.ovopark.cloudpos/com.ovopark.cloudpos.ui.splash.SplashActivity}
  2025-06-04 10:54:58.695  1446-1446  (LogManager.kt:149) i   com.ovopark.cloudpos                 I  (BootReceiver.kt:69) launchApp() å¼€å§‹å¯åŠ¨åº”ç”¨...
  2025-06-04 10:54:58.700   508-783   ActivityTaskManager     system_server                        I  START u0 {act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] flg=0x10000000 pkg=com.ovopark.cloudpos cmp=com.ovopark.cloudpos/.ui.splash.SplashActivity} from uid 10083
  2025-06-04 10:54:58.702   508-783   ActivityTaskManager     system_server                        W  Background activity start [callingPackage: com.ovopark.cloudpos; callingUid: 10083; appSwitchState: 2; isCallingUidForeground: false; callingUidHasAnyVisibleWindow: false; callingUidProcState: RECEIVER; isCallingUidPersistentSystemProcess: false; realCallingUid: 10083; isRealCallingUidForeground: false; realCallingUidHasAnyVisibleWindow: false; realCallingUidProcState: RECEIVER; isRealCallingUidPersistentSystemProcess: false; originatingPendingIntent: null; allowBackgroundActivityStart: false; intent: Intent { act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] flg=0x10000000 pkg=com.ovopark.cloudpos cmp=com.ovopark.cloudpos/.ui.splash.SplashActivity }; callerApp: ProcessRecord{b31f3f9 1446:com.ovopark.cloudpos/u0a83}; inVisibleTask: false]
  2025-06-04 10:54:58.720  1446-1446  (LogManager.kt:149) i   com.ovopark.cloudpos                 I  (BootReceiver.kt:71) launchApp() åº”ç”¨å¯åŠ¨å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼
  2025-06-04 10:54:58.725  1446-1446  Choreographer           com.ovopark.cloudpos                 I  Skipped 31 frames!  The application may be doing too much work on its main thread.
  2025-06-04 10:54:59.042   508-989   ActivityManager         system_server                        I  com.android.managedprovisioning is exempt from freezer
  2025-06-04 10:54:59.063   508-549   ActivityManager         system_server                        I  Start proc 1669:com.android.managedprovisioning/u0a15 for broadcast {com.android.managedprovisioning/com.android.managedprovisioning.BootReminder}
  
  ```

### 2.2 æ ¹æœ¬åŸå› æ¨ç†

- BootReceiver æ­£å¸¸å·¥ä½œ

  - ```
    10:54:58.678 - ç³»ç»Ÿå¯åŠ¨å®Œæˆï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥
    10:54:58.684 - ç½‘ç»œå·²è¿æ¥ï¼Œå¯åŠ¨åº”ç”¨  
    10:54:58.690 - è·å–åˆ°å¯åŠ¨ Intent: ComponentInfo{com.ovopark.cloudpos/com.ovopark.cloudpos.ui.splash.SplashActivity}
    10:54:58.720 - åº”ç”¨å¯åŠ¨å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼
    ```

- ç³»ç»Ÿç¡®å®æ‰§è¡Œäº†å¯åŠ¨

  - ```
    10:54:58.700 ActivityTaskManager - START u0 {act=android.intent.action.MAIN...cmp=com.ovopark.cloudpos/.ui.splash.SplashActivity}
    ```

- ä½†æ˜¯åå°å¯åŠ¨é™åˆ¶è­¦å‘Šï¼š

  - ```
    Background activity start [callingPackage: com.ovopark.cloudpos...allowBackgroundActivityStart: false]
    ```

- è¿™è¯´æ˜ Android ç³»ç»Ÿé˜»æ­¢äº†åå°å¯åŠ¨ Activityã€‚è¿™æ˜¯ Android 10+ (API 29+) çš„å®‰å…¨é™åˆ¶ã€‚



## 03.ä»£ç åˆ†æ

### 3.1 å…³è”ä»£ç è·¯å¾„

### 3.2 å¯ç–‘ä¿®æ”¹ç‚¹

## 04.å¤ç°æ­¥éª¤



## 05.è§£å†³æ–¹æ¡ˆå°è¯•

### 5.1 å·²å°è¯•æ–¹æ¡ˆ

| å°è¯•æ–¹æ¡ˆ                               | æ‰§è¡Œå‘½ä»¤                                     | ç»“æœ                  | éªŒè¯æ—¶é—´         |
| :------------------------------------- | :------------------------------------------- | :-------------------- | :--------------- |
| intentä¸­æ·»åŠ å¿…è¦çš„flagç»•è¿‡åå°å¯åŠ¨é™åˆ¶ |                                              | âŒ å¤±è´¥ï¼Œä¼šè‡ªåŠ¨åˆ é™¤apk | 2025-06-04 11:08 |
| å¼ºåˆ¶å¸è½½                               | `pm uninstall --user 0 com.ovopark.cloudpos` | âœ… ä¸´æ—¶è§£å†³            | 2025-06-04 11:35 |
| é‡å»ºåŒ…æ•°æ®åº“                           | `rm /data/system/packages.xml`               | âš ï¸ ç³»ç»Ÿå´©æºƒ            | 2025-06-04 11:50 |

### 5.2 æ¨èæ–¹æ¡ˆ

```
+ å®‰å…¨å¸è½½æµç¨‹ï¼š
  adb shell pm uninstall --user all com.ovopark.cloudpos
  adb reboot
  
+ æ•°æ®åº“ä¿®å¤å·¥å…·ï¼š
  use PackageManager.forceVerifyPackages()
```



## 06.æ ¹æœ¬åŸå› å’Œä¿®å¤

### 6.1 æœ€ç»ˆå®šä½

- `/data/system/packages.xml` ä¸­å­˜åœ¨æ— æ•ˆæ¡ç›®ï¼š

- ```
  <package name="com.ovopark.cloudpos" 
           userId="10083" 
           ...>
    <!-- ç¼ºå°‘å…³é”®çš„ <metadata> æ ‡ç­¾ -->
  </package>
  ```

### 6.2 ä¿®å¤æ–¹æ¡ˆ



## 07.ç»éªŒæ€»ç»“

### 7.1 æŠ€æœ¯åŸç†

### 7.2 é¢„é˜²æªæ–½

### 7.3 å¸è½½è§„èŒƒ

### 7.4 è°ƒè¯•æŠ€å·§

