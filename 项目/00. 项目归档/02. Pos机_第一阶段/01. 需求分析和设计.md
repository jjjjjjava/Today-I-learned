[toc]

## 01.需求分析

- 当前的项目有哪些需求？
- 设想一个使用它的场景：
- 首先在用户到来之前，商家要去开机，将我们的pos机（可以理解为平板）开机，绑定商家的信息。这个过程我们需要如下：
  - 联网校验本地Token的有效性，如果有效，跳转到MainActivity中，如果无效，跳转到LoginActivity。如果网络错误，显示网络错误的视图。加载过程中显示加载的进度条以及更新加载中的文字。
- 好，现在到用户实际使用了，用户拿起商品，到pos机旁边的扫码枪附近，去扫码。这个过程我们需要如下：
  - 扫码枪识别到商品二维码，发送网络数据到后端。（这个不需要我们去执行）
  - 安卓平板读取网络后台数据，获取到商品信息，将其加入到购物车（同一类型需要增加数量）
  - 用户可以点击平板增减商品数量
  - 增减过程中要始终保持订单的计算
  - 提供清空按钮，用户可以点击清空。或者超过时限清空。
- ok，现在到付款页面，用户点击付款，这个过程我们需要如下：
  - 显示两个可选的按钮，点击支付宝，显示支付宝扫码支付。
  - 点击微信，显示微信扫码支付。
- 我没理解的是：商户app扫设备绑定是什么意思？
- 崩溃自启动如何处理？

## 02.需求设计

### 2.1 功能设计

- Application中初始化第三方SDK。

- SplashActivity：
  - 通过ViewModel去网络上验证自身持有的本地token的有效性。
  - 根据网络返回的状态：
    - 有效：MainActivity
    - 无效：LoginActivity
    - 网络错误：展示等待网络的图片和点击重试的按钮
  - 点击重试按钮，继续上方的步骤
- LoginActivity：
  - 显示二维码。
  - 用户扫码，触发Model更新，被分配新的token
  - 通过ViewModel订阅token更新状态，验证有效性后跳转到MainActivity
- MainActivity：
  - 商城主界面，内部一个RecyclerView，存放商品列表
  - 被动网络获取用户扫码的商品结果，增量添加到商品列表并更新视图显示出来，先全部渲染，然后优化局部渲染
  - 用户点击 - / + 去增减商品，显示商品数量
  - 底部实时更新总价格。
  - 用户点击结算，跳转到结算页面
  - 底部包含一键清空功能
- 结算Activity：
  - 首先是一个Fragment：显示两个部分，分别是支付宝 | 微信支付
  - 点击两侧，跳转到支付二级页面Fragment，显示对应的二维码。有回退按钮可以回退到上一级的Fragment。
  - 实时获取支付结果，如果成功，弹窗支付成功。如果失败，弹窗网络问题，请联系管理员。
- 