[toc]

## 00.é‡æ„æ¦‚è¿°

- **é‡æ„ID**ï¼š`refactor-20250619-001`  
- **é‡æ„åç§°**ï¼šå¼¹çª—ç®¡ç†ç³»ç»Ÿ  ï¼ˆè€ƒè™‘åˆ°åªæœ‰mainä¸­æœ‰é¢‘ç¹çš„å¼¹çª—ï¼Œå› æ­¤æš‚æ—¶æ— éœ€å…¨å±€å”¯ä¸€å•ä¾‹ï¼Œå»å¤„ç†mainå’Œpaymentä¸­çš„å¼¹çª—ã€‚ï¼‰
- **ç›®æ ‡ç‰ˆæœ¬**ï¼šv0.2.0  
- **é‡æ„ç±»å‹**ï¼šâœ… æ¶æ„çº§é‡æ„ -
  - [x] ä¸€æ­¥åˆ°ä½æ¨¡å¼  
  - [ ] å¾ªåºæ¸è¿›é€æ­¥æ›¿ä»£æ¨¡å¼
- **é‡æ„è´Ÿè´£äºº**ï¼š@panruiqi  
- **å®Œæˆæ—¶é—´**ï¼š2025å¹´06æœˆ21æ—¥  
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  

---

## 01.é‡æ„ç›®æ ‡

### 1.1 åŸæœ‰é—®é¢˜

- **XMLè‡ƒè‚¿**ï¼šæ¯ä¸ªActivityå¸ƒå±€ç¡¬ç¼–ç å¼¹çª—include
  - ![image-20250620110140742](../../_pic_/image-20250620110140742.png)
- **çŠ¶æ€æ··ä¹±**ï¼šå¼¹çª—çŠ¶æ€åˆ†æ•£åœ¨å¤šä¸ªæ–¹æ³•
  - ![image-20250620110214892](../../_pic_/image-20250620110214892.png)
- **ä¼˜å…ˆçº§å†²çª**ï¼šMain/PaymentActivityé€»è¾‘ä¸ä¸€è‡´
  - mainä¸­æœ‰çŠ¶æ€ç®¡ç†ï¼Œpaymentä¸­æ²¡æœ‰çŠ¶æ€ç®¡ç†
- **æ‰©å±•å›°éš¾**ï¼šæ–°å¢å¼¹çª—éœ€ä¿®æ”¹å¤šæ–‡ä»¶
  - xmlï¼ŒUIå†…éƒ¨ä¼˜å…ˆçº§ï¼ŒUIå†…éƒ¨çš„ æ˜¾ç¤ºæç¤ºï¼Œæ˜¾ç¤ºå•†å“åˆ—è¡¨ç•Œé¢ç­‰éƒ½éœ€è¦è¢«ä»–å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæ–°å¢ä¸€ä¸ªå¼¹çª—ï¼Œéœ€è¦ä¿®æ”¹å†…éƒ¨çš„å¤šä¸ªæ— å…³çš„æ–¹æ³•ã€‚ä»…ä»…æ˜¯å› ä¸ºshowçš„æ—¶å€™è¦ç¡®ä¿ä»–ä»¬çš„visibleä¸ºfalse
    - ![image-20250620110522738](../../_pic_/image-20250620110522738.png)
- **å†…å­˜æµªè´¹**ï¼šæ‰€æœ‰å¼¹çª—Viewå¸¸é©»å†…å­˜
  - activity_xmlå†…éƒ¨æœ‰å¤šä¸ªå¼¹çª—èµ„æºï¼Œå› æ­¤å¸¸é©»å†…å­˜ã€‚
  - ![image-20250620110654948](../../_pic_/image-20250620110654948.png)
- **ä»£ç é‡å¤**ï¼šå¤§é‡é‡å¤æ˜¾ç¤º/éšè—é€»è¾‘
  - ![image-20250620110316311](../../_pic_/image-20250620110316311.png)
  - ![image-20250620110352772](../../_pic_/image-20250620110352772.png)

### 1.2 é‡æ„ç›®æ ‡

- **ç»Ÿä¸€ç®¡ç†**ï¼šå»ºç«‹ç‹¬ç«‹å¼¹çª—ç³»ç»Ÿ
- **åŠ¨æ€åˆ›å»º**ï¼šæŒ‰éœ€åˆ›å»ºViewï¼ŒèŠ‚çœå†…å­˜
- **æ™ºèƒ½ä¼˜å…ˆçº§**ï¼šè‡ªåŠ¨å¤„ç†å¼¹çª—æŠ¢å 
- **çŠ¶æ€éš”ç¦»**ï¼šActivityé—´çŠ¶æ€ç‹¬ç«‹
- **æ•°æ®é©±åŠ¨**ï¼šåŸºäºé…ç½®åˆ›å»ºå¼¹çª—
- **é›¶XMLä¿®æ”¹**ï¼šæ–°å¢å¼¹çª—ä¸ä¿®æ”¹å¸ƒå±€

---

## 02.æ–°æ¶æ„è®¾è®¡

### 2.1 æ ¸å¿ƒç»„ä»¶

```kotlin
popup/
â”œâ”€â”€ PopupType.kt     // å¼¹çª—ç±»å‹+ä¼˜å…ˆçº§å®šä¹‰
â”œâ”€â”€ PopupConfig.kt   // é…ç½®æ•°æ®ç±»
â”œâ”€â”€ PopupManager.kt  // æ ¸å¿ƒç®¡ç†å™¨
â””â”€â”€ PopupFactory.kt  // å¼¹çª—å·¥å‚
```

### 2.2 æ¶æ„ç‰¹ç‚¹

#### 1.ç‹¬ç«‹å®ä¾‹ç®¡ç†

- è€ƒè™‘åˆ°åªæœ‰mainä¸­æœ‰é¢‘ç¹çš„å¼¹çª—ï¼Œå› æ­¤æš‚æ—¶æ— éœ€å…¨å±€å”¯ä¸€å•ä¾‹ï¼Œå»å¤„ç†mainå’Œpaymentä¸­çš„å¼¹çª—ã€‚

- ```
  // æ¯ä¸ªActivityæ‹¥æœ‰ç‹¬ç«‹çš„å¼¹çª—ç®¡ç†å™¨å®ä¾‹
  val popupManager = PopupManager.getInstance(activity)
  ```

#### 2.ä¼˜å…ˆçº§ç®¡ç†

- å¼¹çª—åˆ†ä¸ºä¸‰ç§ä¼˜å…ˆçº§ï¼šDialog-æœ€é«˜ï¼ŒToast-ä¸­ç­‰ï¼Œé€šçŸ¥-æœ€ä½

- ```
  /**
   * å¼¹çª—ç±»å‹å®šä¹‰
   * æ¯ç§ç±»å‹éƒ½æœ‰æ˜ç¡®çš„ä¼˜å…ˆçº§å’Œè¡Œä¸ºç‰¹å¾
   */
  enum class PopupType(val priority: Int, val category: String) {
      // é€šçŸ¥ç±»å¼¹çª— - æœ€ä½ä¼˜å…ˆçº§
      NOTIFICATION(1, "notification"),
      
      // Toastç±»å¼¹çª— - ä¸­ç­‰ä¼˜å…ˆçº§ï¼ŒåŒç±»å¯æŠ¢å 
      TOAST_PRODUCT_SUCCESS(2, "product_toast"),     // å•†å“æ·»åŠ æˆåŠŸ
      TOAST_CALL_HELP_SUCCESS(2, "call_help_toast"), // å‘¼å«æˆåŠŸ
      TOAST_CALL_HELP_FAILED(2, "call_help_toast"),  // å‘¼å«å¤±è´¥
      
      // Dialogç±»å¼¹çª— - æœ€é«˜ä¼˜å…ˆçº§ï¼Œé˜»å¡æ€§
      DIALOG_DELETE_CONFIRM(3, "confirm_dialog"),     // åˆ é™¤ç¡®è®¤
      DIALOG_CLEAR_CART_CONFIRM(3, "confirm_dialog"), // æ¸…ç©ºè´­ç‰©è½¦ç¡®è®¤
      DIALOG_CANCEL_DEAL_CONFIRM(3, "confirm_dialog") // å–æ¶ˆäº¤æ˜“ç¡®è®¤
  }
  
  
  
  class PopupManager {
      
      fun showPopup(config: PopupConfig) {
          when {
              canShowImmediately(config) -> showPopupDirectly(config)
              canPreempt(config) -> preemptAndShow(config)
              else -> addToQueue(config)
          }
      }
      
      private fun canPreempt(config: PopupConfig): Boolean {
          val current = currentPopupState ?: return true
          
          return when (config.preemptRule) {
              PreemptRule.FORCE -> true
              PreemptRule.HIGHER_PRIORITY -> config.type.priority > current.config.type.priority
              PreemptRule.SAME_CATEGORY -> config.type.category == current.config.type.category
              PreemptRule.NONE -> false
          }
      }
  }
  ```

#### 3. æŠ¢å è§„åˆ™

- ```
  enum class PreemptRule {
      NONE,              // ä¸å¯æŠ¢å 
      SAME_CATEGORY,     // åŒç±»åˆ«å¯æŠ¢å  (Toastç±»å¼¹çª—)
      HIGHER_PRIORITY,   // é«˜ä¼˜å…ˆçº§å¯æŠ¢å 
      FORCE             // å¼ºåˆ¶æŠ¢å  (Dialogç±»å¼¹çª—)
  }
  ```

#### 4.å¼¹çª—é…ç½®

- ```
  data class PopupConfig(
      val id: String,                    // å”¯ä¸€æ ‡è¯†
      val type: PopupType,              // å¼¹çª—ç±»å‹
      val layoutRes: Int,               // å¸ƒå±€èµ„æº
      val behavior: PopupBehavior,      // è¡Œä¸ºé…ç½®
      val preemptRule: PreemptRule,     // æŠ¢å è§„åˆ™
      val data: Map<String, Any>,       // æ•°æ®ç»‘å®š
      val bindings: PopupBindings       // å›è°ƒç»‘å®š
  )
  ```

#### 5.å¼¹çª—å·¥å‚

- ```
  object PopupFactory {
      
      // å•†å“æ·»åŠ æˆåŠŸ
      fun createProductAddedPopup(product: Product): PopupConfig
      
      // é”™è¯¯é€šçŸ¥
      fun createErrorNotification(message: String): PopupConfig
      
      // åˆ é™¤ç¡®è®¤
      fun createDeleteConfirmDialog(productId: Int, productName: String, onConfirm: () -> Unit): PopupConfig
      
      // æ¸…ç©ºè´­ç‰©è½¦ç¡®è®¤
      fun createClearCartConfirmDialog(onConfirm: () -> Unit): PopupConfig
      
      // å‘¼å«å®¢æœæˆåŠŸ/å¤±è´¥
      fun createCallHelpSuccessPopup(): PopupConfig
      fun createCallHelpFailedPopup(): PopupConfig
      
      // å–æ¶ˆäº¤æ˜“ç¡®è®¤ï¼ˆPaymentActivityï¼‰
      fun createCancelDealConfirmDialog(onConfirm: () -> Unit): PopupConfig
  }
  ```

## 03.æ–‡ä»¶ç»“æ„å˜åŒ–

### 3.1 æ–°å¢æ–‡ä»¶

```
app/src/main/java/com/ovopark/cloudpos/popup/
â”œâ”€â”€ PopupType.kt                   # å¼¹çª—ç±»å‹å®šä¹‰
â”œâ”€â”€ PopupConfig.kt                 # é…ç½®æ•°æ®ç±»
â”œâ”€â”€ PopupManager.kt                # æ ¸å¿ƒç®¡ç†å™¨
â””â”€â”€ PopupFactory.kt                # å¼¹çª—å·¥å‚
```

### 3.2 ä¿®æ”¹å†…å®¹

- ä»activity_main.xmlç§»é™¤ï¼š

  - `layout_main_product_added_popup`

  - `layout_main_add_product_error_popup`
  - `layout_main_delete_confirm_popup`
  - `layout_main_clear_cart_confirm_popup`
  - `layout_main_callforhelp_success`
  - `layout_main_callforhelp_failed`

- ä»MainActivity.ktç§»é™¤ï¼š

  - æ‰€æœ‰å¼¹çª—ç›¸å…³çš„bindingå¼•ç”¨
  - `PopupPriority`æšä¸¾å’Œç›¸å…³æ–¹æ³•
  - å„ç§Timerå˜é‡å’Œç®¡ç†é€»è¾‘
  - `showProductAddedPopup`æ–¹æ³•
  - `hideProductAddedPopup`æ–¹æ³•
  - `showAddProductErrorPopup`æ–¹æ³•
  - `hideAddProductErrorPopup`æ–¹æ³•
  - `showDeleteConfirmPopup`æ–¹æ³•
  - `hideDeleteConfirmPopup`æ–¹æ³•

- ç­‰ç­‰...ï¼ˆçº¦500è¡Œä»£ç ï¼‰

### 3.3 å¤‡ä»½æ–‡ä»¶

- ```
  å¤‡ä»½æ–‡ä»¶ï¼š
  â”œâ”€â”€ activity_main_old.xml          # åŸå¸ƒå±€æ–‡ä»¶å¤‡ä»½
  â””â”€â”€ MainActivity_old.kt            # åŸMainActivityå¤‡ä»½
  ```

## 04.ä½¿ç”¨æ–¹å¼å¯¹æ¯”

### 4.1 é‡æ„å‰ï¼ˆæ—§æ–¹å¼ï¼‰

```
// æ˜¾ç¤ºå•†å“æ·»åŠ æˆåŠŸå¼¹çª— - å¤æ‚çš„çŠ¶æ€ç®¡ç†
private fun showProductAddedPopup(product: Product) {
    // å–æ¶ˆä¹‹å‰çš„è®¡æ—¶å™¨
    productAddedPopupTimer?.cancel()
    
    // æ£€æŸ¥ä¼˜å…ˆçº§
    if (!canShowPopup(PopupPriority.MEDIUM)) {
        return
    }
    
    // éšè—ä½ä¼˜å…ˆçº§å¼¹çª—
    binding.layoutMainAddProductErrorPopup.cvAddProductErrorPopupContainer.visibility = View.GONE
    
    // è®¾ç½®å¼¹çª—å†…å®¹
    with(binding.layoutMainProductAddedPopup) {
        Glide.with(this@MainActivity)
            .load(ImageUrlHelper.getSafeImageUrl(product.img))
            .placeholder(R.drawable.ic_barcode_scanner)
            .error(R.drawable.ic_barcode_scanner)
            .into(binding.layoutMainProductAddedPopup.ivProductAddedImage)
        
        binding.layoutMainProductAddedPopup.tvProductAddedName.text = product.goodsName
        binding.layoutMainProductAddedPopup.tvProductAddedPrice.text = "Â¥ ${String.format("%.2f", product.price)}"
        
        // æ˜¾ç¤ºå¼¹çª—å¹¶åº”ç”¨åŠ¨ç”»
        binding.layoutMainProductAddedPopup.cvProductAddedPopupContainer.visibility = View.VISIBLE
        binding.layoutMainProductAddedPopup.cvProductAddedPopupContainer.
            startAnimation(AnimationUtils.loadAnimation(this@MainActivity, android.R.anim.fade_in))
    }
    
    // è®¾ç½®å®šæ—¶å™¨
    productAddedPopupTimer = object : CountDownTimer(3000, 1000) {
        override fun onTick(millisUntilFinished: Long) {
            val secondsLeft = millisUntilFinished / 1000 + 1
            binding.layoutMainProductAddedPopup.tvProductAddedCountdown.text = "${secondsLeft}s"
        }
        
        override fun onFinish() {
            hideProductAddedPopup()
        }
    }.start()
}
```

### 4.2 é‡æ„åï¼ˆæ–°æ–¹å¼ï¼‰

- **ä»£ç é‡å¯¹æ¯”ï¼šé‡æ„å‰50+è¡Œ â†’ é‡æ„å4è¡Œï¼Œå‡å°‘92%**

- ```
  // æ˜¾ç¤ºå•†å“æ·»åŠ æˆåŠŸå¼¹çª— - æç®€åŒ–
  private fun showProductAdded(product: Product) {
      LogManager.ui("æ˜¾ç¤ºå•†å“æ·»åŠ æˆåŠŸå¼¹çª—: ${product.goodsName}")
      val config = PopupFactory.createProductAddedPopup(product)
      popupManager.showPopup(config)
  }
  ```

## 05.æ ¸å¿ƒä¼˜åŠ¿

| ç»´åº¦           | é‡æ„å‰                                                       | é‡æ„å                                                 |
| :------------- | :----------------------------------------------------------- | :----------------------------------------------------- |
| **ä½¿ç”¨å¤æ‚åº¦** | æ˜¾ç¤ºä¸€ä¸ªå¼¹çª—éœ€è¦50+è¡Œä»£ç                                     | æ˜¾ç¤ºä¸€ä¸ªå¼¹çª—åªéœ€è¦2-4è¡Œä»£ç                             |
| **æ‰©å±•æˆæœ¬**   | æ–°å¢å¼¹çª—éœ€è¦åœ¨activity_main.xmlä¸­æ·»åŠ includeï¼ŒåŒæ—¶ä¿®æ”¹activityä¸­è¯¸å¤šä»£ç  | ä»…æ·»åŠ å·¥å‚æ–¹æ³•                                         |
| **å†…å­˜å ç”¨**   | æ‰€æœ‰å¼¹çª—Viewå¸¸é©»å†…å­˜                                         | æŒ‰éœ€åˆ›å»ºå’Œé”€æ¯å¼¹çª—View                                 |
| **çŠ¶æ€ç®¡ç†**   | æ‰‹åŠ¨ç®¡ç†å„ç§Timerå’Œä¼˜å…ˆçº§                                    | è‡ªåŠ¨å¤„ç†ä¼˜å…ˆçº§ã€æŠ¢å ã€é˜Ÿåˆ—ç­‰æ‰€æœ‰é€»è¾‘                   |
| **è·¨Activity** | çŠ¶æ€å…±äº«                                                     | å®Œå…¨éš”ç¦»                                               |
| **ç»Ÿä¸€æ¥å£**   | æ¯ç§å¼¹çª—æœ‰ä¸åŒçš„æ˜¾ç¤ºæ–¹æ³•                                     | æ‰€æœ‰å¼¹çª—ä½¿ç”¨ç»Ÿä¸€çš„`popupManager.showPopup(config)`æ¥å£ |

- è¿™é‡Œæ˜¯xmlå¯¹æ¯”ï¼š
  - å†…éƒ¨ä¸å†æœ‰å¤šä½™çš„å¼¹çª—è§†å›¾æ–‡ä»¶ã€‚
  - ![image-20250620113912967](../../_pic_/image-20250620113912967.png)

------

## 06.é‡æ„æ•ˆæœé‡åŒ–

### 6.1 ä»£ç é‡å‡å°‘

| æ–‡ä»¶              | é‡æ„å‰ | é‡æ„å | å˜åŒ– |
| :---------------- | :----- | :----- | :--- |
| MainActivity.kt   | 1338è¡Œ | 730è¡Œ  | â–¼50% |
| activity_main.xml | 292è¡Œ  | 220è¡Œ  | â–¼25% |
| å¼¹çª—ç›¸å…³ä»£ç       | 500è¡Œ  | 50è¡Œ   | â–¼90% |

### 6.2 æ–°å¢æ ¸å¿ƒç»„ä»¶

- `PopupManager.kt`ï¼š350è¡Œ
- `PopupFactory.kt`ï¼š300è¡Œ
- `PopupConfig.kt`ï¼š100è¡Œ
- `PopupType.kt`ï¼š50è¡Œ

### 6.3 å‡€æ•ˆæœ

- **æ€»åˆ é™¤ä»£ç **ï¼š~500è¡Œ
- **æ€»æ–°å¢ä»£ç **ï¼š~800è¡Œ
- **å‡€å¢åŠ **ï¼š~300è¡Œï¼Œä½†è¿™äº›ä»£ç éƒ½è¢«æŠ½å‡ºæ¥äº†ï¼Œæ”¾åœ¨å…¬æœ‰å·¥å…·ç±»ä¸­ï¼Œè¿™ä½¿å¾—ä»¥åä½¿ç”¨ä¸éœ€è¦å‘MainActivity.ktä¸­ä»£ç è¿™ä¹ˆå¤šäº†ï¼Œåªéœ€è¦è°ƒç”¨æ–¹æ³•å³å¯ï¼Œæå¤§é™ä½äº†å¤æ‚çš„ã€‚åŠŸèƒ½æ›´å¼ºå¤§ï¼Œç»´æŠ¤æ€§å¤§å¹…æå‡ï¼Œå‚è€ƒ**04.ä½¿ç”¨æ–¹å¼å¯¹æ¯”**

## 07.æµ‹è¯•å»ºè®®

### 7.1 åŠŸèƒ½æµ‹è¯•

1. **åŸºç¡€å¼¹çª—æ˜¾ç¤º**
   - [ ] å•†å“æ·»åŠ æˆåŠŸå¼¹çª—
   - [ ] é”™è¯¯é€šçŸ¥å¼¹çª—
   - [ ] åˆ é™¤ç¡®è®¤å¼¹çª—
   - [ ] æ¸…ç©ºè´­ç‰©è½¦ç¡®è®¤å¼¹çª—
   - [ ] å‘¼å«å®¢æœæˆåŠŸ/å¤±è´¥å¼¹çª—

2. **ä¼˜å…ˆçº§æµ‹è¯•**
   - [ ] Dialogå¼¹çª—æŠ¢å Toastå¼¹çª—
   - [ ] åŒç±»Toastå¼¹çª—ç›¸äº’æŠ¢å 
   - [ ] é”™è¯¯é€šçŸ¥å¼¹çª—ä¸æŠ¢å å…¶ä»–å¼¹çª—

3. **è‡ªåŠ¨éšè—æµ‹è¯•**
   - [ ] Toastå¼¹çª—3ç§’è‡ªåŠ¨æ¶ˆå¤±
   - [ ] Dialogå¼¹çª—10ç§’è‡ªåŠ¨å–æ¶ˆ
   - [ ] å€’è®¡æ—¶æ˜¾ç¤ºæ­£ç¡®

4. **é®ç½©æµ‹è¯•**
   - [ ] Dialogå¼¹çª—æ˜¾ç¤ºé®ç½©
   - [ ] ç‚¹å‡»é®ç½©å¤–éƒ¨ä¸å…³é—­å¼¹çª—
   - [ ] é®ç½©å±‚é˜»æ­¢åº•å±‚äº¤äº’

5. **çŠ¶æ€éš”ç¦»æµ‹è¯•**
   - [ ] MainActivityå¼¹çª—ä¸å½±å“PaymentActivity
   - [ ] Activityåˆ‡æ¢æ—¶å¼¹çª—çŠ¶æ€æ­£ç¡®

### 7.2 æ€§èƒ½æµ‹è¯•

1. **å†…å­˜ä½¿ç”¨**
   - [ ] å¼¹çª—æŒ‰éœ€åˆ›å»ºï¼Œä¸æµªè´¹å†…å­˜
   - [ ] å¼¹çª—æ­£ç¡®é”€æ¯ï¼Œæ— å†…å­˜æ³„æ¼

2. **å“åº”é€Ÿåº¦**
   - [ ] å¼¹çª—æ˜¾ç¤ºæ— å»¶è¿Ÿ
   - [ ] æŠ¢å é€»è¾‘æ— å¡é¡¿

### 7.3 è¾¹ç•Œæµ‹è¯•

1. **å¹¶å‘æ˜¾ç¤º**
   - [ ] å¿«é€Ÿè¿ç»­æ˜¾ç¤ºå¤šä¸ªå¼¹çª—
   - [ ] å¼¹çª—é˜Ÿåˆ—æ­£ç¡®å¤„ç†

2. **å¼‚å¸¸å¤„ç†**
   - [ ] å¸ƒå±€èµ„æºä¸å­˜åœ¨æ—¶çš„å¤„ç†
   - [ ] æ•°æ®ç»‘å®šå¼‚å¸¸æ—¶çš„å¤„ç†

### 7.4 å¿…æµ‹é¡¹ç›®

- åŸºç¡€å¼¹çª—æ˜¾ç¤ºåŠŸèƒ½
- ä¼˜å…ˆçº§æŠ¢å é€»è¾‘
- è‡ªåŠ¨éšè—è®¡æ—¶å™¨
- å†…å­˜æ³„æ¼æ£€æµ‹
- è·¨ActivityçŠ¶æ€éš”ç¦»

------

## 08.æ‰©å±•æŒ‡å—

### 8.1 æ–°å¢å¼¹çª—ç±»å‹

#### 1. **åœ¨PopupType.ktä¸­æ·»åŠ æ–°ç±»å‹**

```
enum class PopupType(val priority: Int, val category: String) {
    // ç°æœ‰ç±»å‹...
    NEW_POPUP_TYPE(2, "new_category")  // æ–°å¢
}
```

#### 2. **åœ¨PopupFactory.ktä¸­æ·»åŠ å·¥å‚æ–¹æ³•**

```
fun createNewPopup(data: Any): PopupConfig {
    return PopupConfig(
        id = "new_popup",
        type = PopupType.NEW_POPUP_TYPE,
        layoutRes = R.layout.new_popup_layout,
        // å…¶ä»–é…ç½®...
    )
}
```

#### 3. **åœ¨Activityä¸­ä½¿ç”¨**

```
private fun showNewPopup(data: Any) {
    val config = PopupFactory.createNewPopup(data)
    popupManager.showPopup(config)
}
```

#### 4.æ–°å¢å¼¹çª—è¡Œä¸º

```
data class PopupBehavior(
    val autoHideDuration: Long = 0L,
    val isModal: Boolean = false,
    val hasOverlay: Boolean = false,
    val customBehavior: String = ""  // æ–°å¢è‡ªå®šä¹‰è¡Œä¸º
)
```

## 09.æ€»ç»“

### 9.1 é‡æ„æˆæœ

âœ… **å®Œå…¨æ¶ˆé™¤äº†XMLç¡¬ç¼–ç å¼¹çª—çš„é—®é¢˜**  
âœ… **å»ºç«‹äº†ç»Ÿä¸€çš„å¼¹çª—ç®¡ç†æ¶æ„**  
âœ… **å®ç°äº†æ™ºèƒ½çš„ä¼˜å…ˆçº§å’ŒæŠ¢å ç³»ç»Ÿ**  
âœ… **å¤§å¹…ç®€åŒ–äº†å¼¹çª—ä½¿ç”¨æ–¹å¼**  
âœ… **å®ç°äº†Activityé—´å¼¹çª—çŠ¶æ€éš”ç¦»**  
âœ… **æä¾›äº†æ˜“äºæ‰©å±•çš„æ¶æ„åŸºç¡€**  

### 9.2 æŠ€æœ¯ä»·å€¼

1. **å¯ç»´æŠ¤æ€§**ï¼šä»£ç é›†ä¸­ç®¡ç†ï¼Œé€»è¾‘æ¸…æ™°
2. **å¯æ‰©å±•æ€§**ï¼šæ–°å¢å¼¹çª—æç®€åŒ–
3. **å¯æµ‹è¯•æ€§**ï¼šç‹¬ç«‹çš„ç®¡ç†å™¨ä¾¿äºå•å…ƒæµ‹è¯•
4. **å¯å¤ç”¨æ€§**ï¼šå…¶ä»–Activityå¯ç›´æ¥å¤ç”¨
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šæŒ‰éœ€åˆ›å»ºï¼ŒèŠ‚çœå†…å­˜

### 9.3 ä¸šåŠ¡ä»·å€¼

1. **å¼€å‘æ•ˆç‡**ï¼šæ–°å¢å¼¹çª—ä»ä¿®æ”¹å¤šä¸ªæ–‡ä»¶ç®€åŒ–ä¸ºæ·»åŠ ä¸€ä¸ªé…ç½®æ–¹æ³•
2. **ç»´æŠ¤æˆæœ¬**ï¼šç»Ÿä¸€ç®¡ç†å‡å°‘bugå’Œç»´æŠ¤å·¥ä½œé‡
3. **ç”¨æˆ·ä½“éªŒ**ï¼šæ™ºèƒ½ä¼˜å…ˆçº§ç¡®ä¿é‡è¦å¼¹çª—ä¸è¢«é®æŒ¡
4. **ç³»ç»Ÿç¨³å®šæ€§**ï¼šå‡å°‘å†…å­˜ä½¿ç”¨å’ŒçŠ¶æ€å†²çª

### 9.4 ä¸‹ä¸€æ­¥è®¡åˆ’

1. **PaymentActivityè¿ç§»**ï¼šä½¿ç”¨ç›¸åŒæ¨¡å¼é‡æ„PaymentActivity
2. **æ‰©å±•åŠŸèƒ½**ï¼šæ·»åŠ æ›´å¤šå¼¹çª—ç±»å‹å’Œè¡Œä¸º
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–å†…å­˜ä½¿ç”¨å’Œå“åº”é€Ÿåº¦
4. **æµ‹è¯•å®Œå–„**ï¼šç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼španruiqi@ovopark.com

**é‡æ„å®Œæˆæ—¶é—´**ï¼š2025å¹´06æœˆ21æ—¥  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0 



