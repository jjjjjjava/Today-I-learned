## 01.代码逻辑

- `ProblemThreeSelectDelegate` 是一个用于 `RecyclerView` 的 **多选/单选代理类**，主要功能包括：
  - **视图绑定**：将 `ProblemFilterResult` 数据绑定到 `GridSelectLayout` 网格布局。
  - **交互处理**：管理用户的点击事件，支持 **多选（含全选逻辑）** 和 **单选模式**。
  - **数据过滤与填充**：动态调整数据，确保每行显示固定数量的项（3 列），并触发回调传递选中结果。

### 1.1 **数据初始化与视图绑定 (`convert` 方法)**

- **数据校验**：检查 `ProblemFilterResult.list` 和 `dataList` 是否为空，避免空数据渲染。

- **标题处理**：

  - ```
    data.name = if (data.name != null) data.name else dataList[data.nameId]
    ```

  - 若 `ProblemFilterData` 的 `name` 为空，从 `dataList` 中按 `nameId` 索引获取标题。

  - **副标题生成**：
    根据 `isMultiSelect` 显示“多选”或“单选”提示，支持通过 `subDesc` 覆盖默认副标题。

  - **网格布局初始化**：
    调用 `selectLayout.initSingleRow` 设置标题、子项数据、颜色、列数（固定为 3）等参数。

### 1.2 **选中状态管理 (`onItemClick` 回调)**

- **多选模式**：

  - **非全选按钮**：
    点击后更新 `isChecked` 状态，并检查是否存在已选中的子项。若存在，取消全选按钮的选中状态。

    ```
    for (i in 2 until list.size) {
        if (list[i].isChecked) {
            list[1].isChecked = false
            break
        }
        list[1].isChecked = true
    }
    ```

  - **全选按钮**：
    点击位置 1（全选按钮）时，仅选中全选按钮，其他子项设为未选中（逻辑矛盾，需确认业务需求）。

  - **级联选中**：
    若选中“已完成”（`R.string.complete_already`），自动勾选所有名称包含该关键字的项（仅在巡店模式下生效）。

- **单选模式**：
  选中某一项后，其他项自动取消选中。

### 1.3 数据过滤与填充 (`getNewList` 方法)

- `getNewList(result.list)` 是一个 **数据预处理方法**，用于将原始的 `ProblemFilterResult.list` 转换为适配 `GridSelectLayout` 显示的新列表。主要完成以下两个任务：
  1. **过滤无效数据**：移除不符合条件的项（如 `id < 0` 或标记为隐藏的项）。
  2. **填充占位数据**：确保每行显示固定数量（3 列）的子项，避免布局错乱。
  3. getNewList()中的 newList.add仅仅是对原始的数据新建了索引，暴露出来纯净的数据



- **过滤无效项**：移除 `id < 0` 或标记为隐藏（`isHide`）的项。

- **补全空位**：
  若过滤后的数据不足 3 的倍数，添加占位数据 `ProblemFilterData("", -1, false)`，确保每行显示 3 项。

  ```
  when ((newList.size - 1) % 3) {
      1 -> add 2 placeholders
      2 -> add 1 placeholder
  }
  ```

### 1.4 回调触发

- **条件触发**：仅当 `list[0].name` 为特定类型（如计划类型、巡店状态）时，通过 `callback(list)` 回传数据。
- **清理回调**：点击清除按钮时，通过 `cleanCallback(id)` 通知外部清理指定 `id` 的筛选条件。







- `getNewList(result.list)` 是一个 **数据预处理方法**，用于将原始的 `ProblemFilterResult.list` 转换为适配 `GridSelectLayout` 显示的新列表。主要完成以下两个任务：
  1. **过滤无效数据**：移除不符合条件的项（如 `id < 0` 或标记为隐藏的项）。
  2. **填充占位数据**：确保每行显示固定数量（3 列）的子项，避免布局错乱。
  3. getNewList()中的 newList.add仅仅是对原始的数据新建了索引，暴露出来纯净的数据





- 数据好像是class ProblemFilterFragment : BaseChangeFragment() 中的

  ```
  selectDelegate =
      ProblemThreeSelectDelegate(mContext, titles, screenWidth, false, false, false, 
  
  
  //刷新适配器
                  adapter?.datas?.clear()
                  adapter?.datas?.addAll(newAllList!!.toList())
                  adapter?.notifyDataSetChanged()
  ```

这里的newAllList啊